{% extends "layout.html" %}

{% block title %}Edit Record{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <!-- Header Section - FIXED -->
        <div class="mb-5" style="text-align: center;">
            <div class="mb-3">
                <i class="bi bi-pencil-square" style="font-size: 4rem; color: #F59E0B;"></i>
            </div>
            <h2 class="fw-bold mb-2" style="color: var(--gray-900);">Edit Health Record</h2>
            <p style="color: var(--gray-600);">
                <i class="bi bi-hash me-1"></i>
                Record ID: <strong>{{ record.id }}</strong>
                <span class="mx-3">|</span>
                <i class="bi bi-calendar me-1"></i>
                Recorded on: <strong>{{ record.timestamp.strftime('%B %d, %Y at %I:%M %p') }}</strong>
            </p>
        </div>

        <!-- Alert Info -->
        <div class="alert alert-info mb-4" style="border-radius: 12px; border: none;">
            <div class="d-flex align-items-center">
                <i class="bi bi-info-circle-fill fs-4 me-3"></i>
                <div>
                    <strong>Note:</strong> You are editing an existing health record. Make sure all values are accurate before saving.
                </div>
            </div>
        </div>

        <!-- Main Form Card -->
        <div class="card dashboard-card">
            <div class="card-header" style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: white; border-bottom: 3px solid #D97706;">
                <h4 class="mb-0">
                    <i class="bi bi-clipboard-data me-2"></i>
                    Update Health Metrics
                </h4>
            </div>
            <div class="card-body p-4">
                <form method="POST" action="{{ url_for('edit_record', record_id=record.id) }}" class="needs-validation" novalidate>
                    
                    <!-- Vital Signs Section -->
                    <div class="mb-5">
                        <h5 class="mb-3 pb-2 border-bottom">
                            <i class="bi bi-activity me-2" style="color: var(--primary-teal);"></i>
                            Vital Signs
                        </h5>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label for="weight" class="form-label fw-bold">
                                    <i class="bi bi-speedometer2 me-1"></i>
                                    Weight (kg)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-calculator"></i>
                                    </span>
                                    <input type="number" step="0.1" class="form-control form-control-lg" 
                                           id="weight" name="weight" value="{{ record.weight }}" required>
                                    <span class="input-group-text">kg</span>
                                </div>
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Previous value: {{ record.weight }} kg
                                </small>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="sugar_level" class="form-label fw-bold">
                                    <i class="bi bi-droplet-half me-1"></i>
                                    Blood Sugar Level (mg/dL)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-graph-up"></i>
                                    </span>
                                    <input type="number" step="0.1" class="form-control form-control-lg" 
                                           id="sugar_level" name="sugar_level" value="{{ record.sugar_level }}" required>
                                    <span class="input-group-text">mg/dL</span>
                                </div>
                                <small class="text-muted">
                                    <i class="bi bi-info-circle me-1"></i>
                                    Normal fasting: 70-100 mg/dL
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- Blood Pressure Section -->
                    <div class="mb-5">
                        <h5 class="mb-3 pb-2 border-bottom">
                            <i class="bi bi-heart-fill me-2 text-danger"></i>
                            Blood Pressure
                        </h5>
                        <div class="row g-4">
                            <div class="col-md-6">
                                <label for="systolic_bp" class="form-label fw-bold">
                                    <i class="bi bi-arrow-up-circle me-1"></i>
                                    Systolic (Upper Reading)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-heart-pulse"></i>
                                    </span>
                                    <input type="number" step="0.1" class="form-control form-control-lg" 
                                           id="systolic_bp" name="systolic_bp" value="{{ record.systolic_bp }}" required>
                                    <span class="input-group-text">mmHg</span>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <label for="diastolic_bp" class="form-label fw-bold">
                                    <i class="bi bi-arrow-down-circle me-1"></i>
                                    Diastolic (Lower Reading)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-heart"></i>
                                    </span>
                                    <input type="number" step="0.1" class="form-control form-control-lg" 
                                           id="diastolic_bp" name="diastolic_bp" value="{{ record.diastolic_bp }}" required>
                                    <span class="input-group-text">mmHg</span>
                                </div>
                            </div>
                        </div>
                        <small class="text-muted d-block mt-2">
                            <i class="bi bi-info-circle me-1"></i>
                            Previous BP: {{ record.systolic_bp }}/{{ record.diastolic_bp }} mmHg
                        </small>
                    </div>
                    
                    <!-- Lifestyle Metrics Section -->
                    <div class="mb-4">
                        <h5 class="mb-3 pb-2 border-bottom">
                            <i class="bi bi-person-arms-up me-2 text-success"></i>
                            Lifestyle & Wellness Metrics
                        </h5>
                        <div class="row g-4">
                            <div class="col-md-4">
                                <label for="sleep_hours" class="form-label fw-bold">
                                    <i class="bi bi-moon-stars me-1"></i>
                                    Sleep Duration (Hours)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-alarm"></i>
                                    </span>
                                    <input type="number" step="0.1" class="form-control form-control-lg" 
                                           id="sleep_hours" name="sleep_hours" min="0" max="15" 
                                           value="{{ record.sleep_hours }}" required>
                                    <span class="input-group-text">hrs</span>
                                </div>
                                <small class="text-muted">Recommended: 7-9 hours</small>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="exercise_minutes" class="form-label fw-bold">
                                    <i class="bi bi-bicycle me-1"></i>
                                    Exercise Duration (Minutes)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-stopwatch"></i>
                                    </span>
                                    <input type="number" class="form-control form-control-lg" 
                                           id="exercise_minutes" name="exercise_minutes" min="0" 
                                           value="{{ record.exercise_minutes }}" required>
                                    <span class="input-group-text">min</span>
                                </div>
                                <small class="text-muted">Target: 30+ minutes daily</small>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="stress_level" class="form-label fw-bold">
                                    <i class="bi bi-emoji-neutral me-1"></i>
                                    Stress Level (1-10)
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text">
                                        <i class="bi bi-thermometer-half"></i>
                                    </span>
                                    <input type="number" class="form-control form-control-lg" 
                                           id="stress_level" name="stress_level" min="1" max="10" 
                                           value="{{ record.stress_level }}" required>
                                </div>
                                <small class="text-muted">1=Relaxed, 10=Very Stressed</small>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="mt-5 pt-4 border-top d-flex gap-3 justify-content-center flex-wrap">
                        <button type="submit" class="btn btn-success btn-lg px-5">
                            <i class="bi bi-check-circle me-2"></i>
                            Save Changes
                        </button>
                        <a href="{{ url_for('view_records') }}" class="btn btn-secondary btn-lg px-5">
                            <i class="bi bi-x-circle me-2"></i>
                            Cancel / Go Back
                        </a>
                    </div>
                </form>
            </div>
        </div>

        <!-- Warning Card -->
        <div class="card dashboard-card mt-4" style="border-left: 4px solid #F59E0B;">
            <div class="card-body">
                <div class="d-flex align-items-start">
                    <i class="bi bi-exclamation-triangle-fill text-warning fs-3 me-3"></i>
                    <div>
                        <h6 class="fw-bold mb-2">Important Reminder</h6>
                        <small class="text-muted">
                            Editing this record will update your health history and may affect AI risk predictions. 
                            Ensure all entered values are accurate and reflect your actual health metrics at the time of recording.
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Form Validation
    (function() {
        'use strict';
        const forms = document.querySelectorAll('.needs-validation');
        Array.from(forms).forEach(function(form) {
            form.addEventListener('submit', function(event) {
                if (!form.checkValidity()) {
                    event.preventDefault();
                    event.stopPropagation();
                }
                form.classList.add('was-validated');
            }, false);
        });
    })();
</script>
{% endblock %}